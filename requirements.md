# Технические требования VK Files

## 1. Термины и определения

​	Приложение - мобильное приложение "VK Files", требования к которому указаны в данном документе.

​	Документ ВК - файл, сохранённый пользователем социальной сети Вконтакте в разделе "Документы" своего аккаунта.

​	ОС - операционная система

​	Тап - касание экрана в отмеченном месте.

## 2. Основные функциональные возможности системы

​	Приложение предназначено для работы со списком документов ВК с мобильного устройства. Функциональные возможности приложения:

- просмотр списка документов ВК
- сортировка документов по имени, дате загрузки, размеру файла, типу файла
- разбиение списка документов ВК на категории в зависимости от типа файла, просмотр списка для каждой категории
- поиск документа ВК по имени файла
- переименование документа ВК
- удаление документа ВК
- загрузка документа ВК в локальное хранилище
- предпросмотр документа ВК штатными средствами ОС
- возможность поделиться документом ВК или открыть его в другом приложении

## 3. Нефункциональные требования

### 3.1 Требования к техническому обеспечению

Приложение предназначено для мобильных устройств под управленем ОС iOS версий 13, 14, 15. Поддерживаемые устройства - модели iPhone 2016 - 2021 годов выпуска.

### 3.2 Требования к локализации

Поддерживаемые языки интерфейса - русский, английский.

## 4. Функциональные требования

### 4.1 Пользовательский интерфейс приложения

#### 4.1.1 Стартовый экран

Условия отображения:

- приложение открыто первый раз
- приложение открыто, но пользователь не авторизован в ВК
- пользователь выбрал пункт "Выйти из аккаунта" на экране дополнительных опций

Содержание экрана:

- название приложения
- логотип приложения
- текст о необходимости входа в аккаунт для доступа к документам ВК
- кнопка входа в аккаунт

Возможные действия:

- нажатие кнопки входа в аккаунт -> запуск механизма авторизации

####  4.1.2  Вкладки в интерфейсе приложения (TabBar)

Условия отображения:

- пользователь авторизован

Содержание вкладок:

1. общий список файлов
2. категории файлов
3. дополнительные опции

Возможные действия:

- выбор вкладки

Детали:

- вкладки постоянно отображаются внизу экрана (системный TabBar)

#### 4.1.3 Экран общего списка документов ВК

Условия отображения:

- открытие приложения, пользователь авторизован
- успешное завершение авторизации
- выбор соответствующей вкладки в TabBar

Содержание экрана:

- заголовок "Мои файлы"
- кнопка выбора режима сортировки
- поле поиска документа
- список документов ВК

При первом с запуска приложения открытии экрана отображается заглушка с анимацией загрузки, выполняется запрос на получение списка документов (описание - https://vk.com/dev/docs.get). После завершения запроса заглушка пропадает.

Если произошла ошибка - отображается заглушка с описанием ошибки.

Если запрос выполнен успешно, отображается список документов. 

Если в ответ пришёл пустой список, отображается текстовая заглушка с предупрежденем об отсутствии документов.

##### 4.1.3.1 Список документов

Главный список документов состоит из строк, каждая из которых описывает документ ВК.

Всё содержимое строки берётся из модели документа ВК (https://vk.com/dev/objects/doc)

Содержание строки:

- маленькое статичное изображение предпросмотра файла, если доступно поле `preview` для документа или заглушка, выбранная на основе категории файла (поле `type`)
- Строка с именем файла (поле `title`)
- Строка с размером файла (поле `size`)
- кнопка загрузки в локальное хранилище (если файл не сохранён в локальное хранилище)
- кнопка отмены загрузки (если файл в процессе загрузки в локальное хранилище)
- шкала прогресса загрузки (если файл в процессе загрузки в локальное хранилище)

Возможные действия:

- Тап по строке с документом, если файл не загружен -> анимация кнопки загрузки - увеличение на 20%
- Тап по по строке с документом, файл загружен -> открытие системного экрана просмора файлов с возможностью поделиться файлом
- Тап по кнопке загрузки -> начало загрузки файла (по ссылке из поля `url`)
- Тап по кнопке отмены загрузки -> прекращение загрузки файла
- Длинный тап по строке с документом -> отображение контекстного меню документа
- Потянуть список документов вниз -> над списком появляется индикатор загрузки, повторяется запрос на получение списка документов, после завершения список обновляется, либо в случае ошибки вместо списка появляется заглушка с ошибкой.

##### 4.1.3.2 Контекстное меню документа

Контекстное меню отображается всплывающим окном.

Содержание:

- пункт "Переименовать"
- пункт "Удалить"
- Пункт "Удалить из локального хранилища" - отображается для загруженных файлов

Возможные действия:

- Выбран пункт "Переименовать". Контекстное меню закрывается. Открывается всплывающее окно переименования файла вместе с клавиатурой.
- Выбран пункт "Удалить". Контекстное меню закрывается. Открывается всплывающее окно подтверждения удаления.
- Выбран пункт "Удалить из локального хранилища". Контекстное меню закрывается. Загруженный файл удаляется. Строка с документом обновляется.

##### 4.1.3.3 Всплывающее окно переименования файла.

Содержание:

- текстовое поле со старым именем файла. Максимальная длина - 128 символов.
- кнопка отмены
- кнопка подтверждения. Активна, когда текстовое поле не пустое

Возможные действия:

- Нажата кнопка отмены -> окно закрывается.
- Нажата кнопка подтверждения -> если имя осталось прежним, окно закрывается. Если имя изменилось, и оно не пустое, вызывается запрос на редактирование документа ( описание - https://vk.com/dev/docs.edit). Окно закрывается. Поверх списка документов заглушка с анимацией загрузки. После окончания загрузки появляется всплывающее окно с результатом операции.

##### 4.1.3.4 Всплывающее окно подтверждения удаления файла.

Содержание:

- кнопка отмены
- кнопка подтверждения

Возможные действия:

- Нажата кнопка отмены -> окно закрывается.
- Нажата кнопка подтверждения -> вызывается запрос на удаление документа ( описание - https://vk.com/dev/docs.delete). Окно закрывается. Поверх списка документов заглушка с анимацией загрузки. После окончания загрузки в случае успеха операции - удаление документа из списка, иначе - всплывающее окно с результатом операции.

##### 4.1.3.5 Всплывающее окно выбора режима сортировки

Условия отображения:

- Нажата кнопка выбора режима сортировки на экране со списком файлов

Содержание:

- список режимов сортировки: по имени, дате загрузки, размеру файла, типу файла. Для каждого 2 строки в списке - по возрастанию и по убыванию

Возможные действия:

- Тап за пределами всплывающего окна -> закрытие окна
- Выбран пункт в списке -> закрытие окна, применение сортиовки к открытому списку документов. Выбранный режим сортировки сохраняется, пока приложение запущено, и повторно применяется при любом обновлении списка документов, в том числе при поиске и при отображении списка для отдельной категории.

##### 4.1.3.6 Поле поиска документа

###### 4.1.3.6.1 Начальное состояние:

Поле содержит текст-заглушку "Поиск файлов"

Возможные действия:

- Тап по полю поиска -> появляется клавиатура. Справа от поля появляется кнопка "Отмена"

###### 4.1.3.6.2 Состояние поиска:

После каждого введённого символа список файлов обновляется. В списке остаются те файлы, названия которых содержат введённый текст. Если таких файлов нет, отображается текстовая заглушка с предупрежденем об отсутствии документов. Если поле поиска пустое, отображаются все файлы.

Возможные действия: 

- Нажатие на кнопку "Отмена" -> клавиатура закрывается, поле переходит в начальное состояние
- Нажатие на клавишу "Enter" на клавиатуре -> клавиатура закрывается, поле остаётся в состоянии поиска. Для появления клавиатуры обратно нужно будет снова нажать на поле поиска.

#### 4.1.4 Экран списка категорий

Условия отображения:

- выбор соответствующей вкладки в TabBar

Содержание экрана:

- заголовок "Категории файлов"
- список категорий документов

Список категорий состоит из строк, каждая из которых описывает категорию дркументов ВК на основе поля `type`:

- *1* — текстовые документы;
- *2* — архивы;
- *3* — gif;
- *4* — изображения;
- *5* — аудио;
- *6* — видео;
- *7* — электронные книги;
- *8* — другое.

Строка списка состоит из картинки-заглушки для категории и названия категории

Возможные действия:

- Тап по строке с категорией - переход на экран выбранной категории

#### 4.1.5 Экран категории

Условия отображения:

- выбрана категория на экране списка категорий

Содержание экрана:

- заголовок с названием категории
- кнопка возврата на экран списка категорий
- кнопка выбора режима сортировки
- список документов ВК

Возможные действия:

- Нажата кнопка возврата на экран списка категорий -> возврат на список категорий

Список документов ведёт себя так же, как и на главном экране со списком документов ВК.

Кнопка сортировки ведёт себя так же, как и на  главном экране со списком документов ВК.

#### 4.1.6 Экран дополнительных опций

Условия отображения:

- выбор соответствующей вкладки в TabBar

Содержание экрана:

- фото профиля пользователя
- имя и фамилия пользователя
- кнопка очистки локального хранилища
- кнопка выхода из аккаунта

При открытии экрана выполняется запрос информации о пользователе (имя, фамилия, ссылка на фото профиля) Описание запроса - https://vk.com/dev/users.get

Во время загрузки и в случае ошибки вместо фото отображается заглушка, вместо имени и фамилии - текст "Пользователь".

Возможные действия:

- Нажата кнопка очистки локального хранилища -> все загруженные файлы удаляются из локального хранилища
- Нажата кнопка выхода из аккаунта -> все загруженные файлы удаляются из локального хранилища, у VK SDK вызывается механизм выхода из аккаунта, открывается стартовый экран приложения.

### 4.2 Механизм авторизации в приложении

Авторизация выполняется с помощью официального VK SDK для iOS. Описание ресурса: https://vk.com/dev/ios_sdk

После запуска механизма на устройстве открывается браузер или приложение ВК (при наличии). После входа в аккаунт ВК в браузере/приложении пользователь там же подтверждает доступ приложения к данным его аккаунта (список документов).

В случае успешного подтверждения доступа пользователь автоматически возвращается в приложение, открывается экран общего списка файлов.

В любом другом случае при возвращении в приложение отображается экран, с которого был запущен механизм авторизации, поверх него всплывающее сообщение с описанием ошибки.

